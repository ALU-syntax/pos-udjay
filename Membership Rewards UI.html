<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kasir – Membership Rewards (Design Only)</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    :root {
      --soft-radius: 1rem;
    }
    .card { border-radius: var(--soft-radius); }
    .btn { border-radius: .9rem; }
    .badge.rounded-xl { border-radius: .8rem; }
    .avatar {
      width: 44px; height: 44px; border-radius: 999px;
      display: inline-flex; align-items: center; justify-content: center;
      font-weight: 600; background: #f3f4f6; color: #111827;
    }
    .scroll-pane { max-height: 480px; overflow: auto; }
    .level-silver { background: #f1f5f9; color: #334155; }
    .level-gold { background: #fef3c7; color: #92400e; }
    .level-platinum { background: #f4f4f5; color: #3f3f46; }
    .pointer { cursor: pointer; }
    .list-empty { color: var(--bs-secondary-color); font-size: .9rem; }
    .mini-stat { border: 1px solid var(--bs-border-color); border-radius: .8rem; padding: .6rem .75rem; text-align: center; }
    .mini-stat .label { font-size: .65rem; letter-spacing: .06em; text-transform: uppercase; color: var(--bs-secondary-color); }
    .mini-stat .value { font-weight: 700; font-size: .95rem; }
    .badge-pill { border-radius: 999px; }
    .hover-card:hover { box-shadow: 0 8px 24px rgba(0,0,0,.06); }
    .form-check-lg .form-check-input { width: 1.25rem; height: 1.25rem; }
  </style>
</head>
<body>
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h1 class="h4 mb-1">Membership</h1>
        <div class="text-secondary small">Cari member lalu pilih rewards untuk transaksi kasir</div>
      </div>
      <div class="d-none d-md-flex align-items-center gap-2 text-secondary small">
        <i class="bi bi-star"></i>
        <span>Design-only • Tidak terhubung backend</span>
      </div>
    </div>

    <div class="row g-3">
      <!-- LEFT: Member list -->
      <div class="col-12 col-md-4">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <h2 class="h6 mb-0">Pilih Member</h2>
              <span class="ms-2 badge bg-light text-secondary">Demo</span>
            </div>
            <div class="input-group mb-3">
              <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
              <input id="searchInput" type="text" class="form-control" placeholder="Cari nama / ID / HP…" />
            </div>
            <div id="memberList" class="scroll-pane pe-1"></div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Summary & Trigger -->
      <div class="col-12 col-md-8">
        <div class="card mb-3">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <h2 class="h6 mb-1">Ringkasan Rewards</h2>
                <div class="small text-secondary">Pantau rewards yang akan diterapkan</div>
              </div>
              <button class="btn btn-primary" id="openRewardsBtn" data-bs-toggle="modal" data-bs-target="#rewardsModal">Pilih / Kelola Rewards</button>
            </div>
            <div id="summaryBadges" class="d-flex flex-wrap gap-2 mb-2"></div>
            <div class="d-flex justify-content-between align-items-center small text-secondary">
              <div>
                Member: <span id="summaryMemberName" class="fw-semibold text-body"></span>
                <span class="text-secondary">•</span>
                <span id="summaryMemberId"></span>
              </div>
              <div id="appliedCountText">Belum ada rewards dipilih</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div>
                <h2 class="h6 mb-1">Catatan / Voucher</h2>
                <div class="small text-secondary">Elemen visual tambahan (opsional)</div>
              </div>
            </div>
            <div class="row g-3">
              <div class="col-md-6">
                <label for="notes" class="form-label">Catatan</label>
                <input id="notes" type="text" class="form-control" placeholder="Contoh: Ulang tahun – minta candle kecil" />
              </div>
              <div class="col-md-6">
                <label for="voucher" class="form-label">Kode Voucher</label>
                <div class="input-group">
                  <input id="voucher" type="text" class="form-control" placeholder="Masukkan kode…" />
                  <button class="btn btn-outline-secondary" type="button">Cek</button>
                </div>
              </div>
            </div>
            <div class="small text-secondary mt-2">* Tidak terhubung – hanya tampilan.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: Rewards Picker -->
  <div class="modal fade" id="rewardsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content" style="border-radius: 1rem; overflow: hidden;">
        <div class="modal-body p-0">
          <div class="row g-0">
            <!-- LEFT PANEL: Member Summary -->
            <div class="col-md-4 bg-body-tertiary p-4">
              <div class="d-flex align-items-center gap-3 mb-3">
                <div class="avatar" id="modalAvatar">AK</div>
                <div>
                  <div class="d-flex align-items-center gap-2">
                    <h5 class="mb-0" id="modalMemberName">Nama Member</h5>
                    <span id="modalLevelBadge" class="badge rounded-pill level-silver">Silver</span>
                  </div>
                  <div class="small text-secondary" id="modalMemberMeta">ID • HP</div>
                </div>
              </div>
              <div class="row g-2 mb-3">
                <div class="col-4">
                  <div class="mini-stat">
                    <div class="label">EXP</div>
                    <div class="value" id="modalExp">0</div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="mini-stat">
                    <div class="label">Points</div>
                    <div class="value" id="modalPoints">0</div>
                  </div>
                </div>
                <div class="col-4">
                  <div class="mini-stat">
                    <div class="label">Birthday</div>
                    <div class="value d-flex align-items-center justify-content-center gap-1">
                      <i class="bi bi-cake2" ></i>
                      <span id="modalBirthday">—</span>
                    </div>
                  </div>
                </div>
              </div>
              <div class="small text-secondary">* Ilustrasi desain: nilai & aturan hanya contoh.</div>
            </div>

            <!-- RIGHT PANEL: Tabs & Rewards -->
            <div class="col-md-8 p-4">
              <div class="mb-3">
                <h5 class="mb-1">Pilih Rewards</h5>
                <div class="small text-secondary">Checklist rewards yang ingin ditambahkan ke transaksi.</div>
              </div>

              <ul class="nav nav-tabs" id="rewardTabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="tab-birthday" data-bs-toggle="tab" data-bs-target="#pane-birthday" type="button" role="tab">
                    <i class="bi bi-cake2 me-2"></i>Birthday
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="tab-level" data-bs-toggle="tab" data-bs-target="#pane-level" type="button" role="tab">
                    <i class="bi bi-award me-2"></i>Level
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="tab-exp" data-bs-toggle="tab" data-bs-target="#pane-exp" type="button" role="tab">
                    <i class="bi bi-cup-hot me-2"></i>EXP
                  </button>
                </li>
              </ul>

              <div class="tab-content pt-3">
                <!-- Birthday -->
                <div class="tab-pane fade show active" id="pane-birthday" role="tabpanel">
                  <div class="card">
                    <div class="card-body">
                      <div class="d-flex align-items-start justify-content-between">
                        <div>
                          <div class="d-flex align-items-center gap-2 mb-1">
                            <i class="bi bi-cake2"></i>
                            <h6 class="mb-0">Birthday Reward</h6>
                          </div>
                          <div class="text-secondary small">Gratis 1 menu "Signature Drink" pada bulan ulang tahun. *Contoh ketentuan: 1x per tahun.</div>
                          <div class="text-secondary small mt-1">Masa berlaku: <span id="birthdayValidity">—</span></div>
                        </div>
                        <div class="form-check form-check-lg">
                          <input class="form-check-input" type="checkbox" id="chkBirthday" />
                          <label class="form-check-label" for="chkBirthday">Tambah</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Level -->
                <div class="tab-pane fade" id="pane-level" role="tabpanel">
                  <div class="card mb-2">
                    <div class="card-body d-flex align-items-start justify-content-between gap-3">
                      <div class="d-flex align-items-start gap-3">
                        <div class="p-2 border rounded-3"><i class="bi bi-percent"></i></div>
                        <div>
                          <div class="fw-semibold">Diskon 10%</div>
                          <div class="small text-secondary">Berlaku untuk semua minuman kecuali seasonal.</div>
                        </div>
                      </div>
                      <div class="form-check form-check-lg pt-1">
                        <input class="form-check-input" type="checkbox" id="chkLevelDiscount10" />
                        <label class="form-check-label" for="chkLevelDiscount10">Pilih</label>
                      </div>
                    </div>
                  </div>
                  <div class="card mb-2">
                    <div class="card-body d-flex align-items-start justify-content-between gap-3">
                      <div class="d-flex align-items-start gap-3">
                        <div class="p-2 border rounded-3"><i class="bi bi-arrow-up-circle"></i></div>
                        <div>
                          <div class="fw-semibold">Upgrade Size Gratis</div>
                          <div class="small text-secondary">Naik 1 level ukuran untuk 1 item minuman.</div>
                        </div>
                      </div>
                      <div class="form-check form-check-lg pt-1">
                        <input class="form-check-input" type="checkbox" id="chkLevelUpgrade" />
                        <label class="form-check-label" for="chkLevelUpgrade">Pilih</label>
                      </div>
                    </div>
                  </div>
                  <div class="card">
                    <div class="card-body d-flex align-items-start justify-content-between gap-3">
                      <div class="d-flex align-items-start gap-3">
                        <div class="p-2 border rounded-3"><i class="bi bi-lightning-charge"></i></div>
                        <div>
                          <div class="fw-semibold">Priority Queue</div>
                          <div class="small text-secondary">Akses jalur prioritas (ilustrasi desain kasir).</div>
                        </div>
                      </div>
                      <div class="form-check form-check-lg pt-1">
                        <input class="form-check-input" type="checkbox" id="chkLevelPriority" />
                        <label class="form-check-label" for="chkLevelPriority">Pilih</label>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- EXP -->
                <div class="tab-pane fade" id="pane-exp" role="tabpanel">
                  <div class="card">
                    <div class="card-body">
                      <div class="d-flex align-items-start justify-content-between flex-wrap gap-3">
                        <div>
                          <div class="d-flex align-items-center gap-2 mb-1">
                            <i class="bi bi-cup-hot"></i>
                            <h6 class="mb-0">Reward per 5.000 EXP</h6>
                          </div>
                          <div class="text-secondary small">Tukar setiap 5.000 EXP menjadi 1 item gratis: <span class="fw-semibold text-body">Kopi Susu</span></div>
                          <div class="text-secondary small mt-1">Ketersediaan: <span id="expAvailable">0</span>x (berdasarkan EXP saat ini)</div>
                        </div>
                        <div class="d-flex align-items-center gap-3">
                          <div class="form-check form-check-lg">
                            <input class="form-check-input" type="checkbox" id="chkExp" />
                            <label class="form-check-label" for="chkExp">Tukarkan</label>
                          </div>
                          <div class="d-flex align-items-center gap-2">
                            <button class="btn btn-outline-secondary" id="btnExpMinus" type="button"><i class="bi bi-dash"></i></button>
                            <div class="text-center fw-semibold" id="expQty" style="width: 40px;">0</div>
                            <button class="btn btn-outline-secondary" id="btnExpPlus" type="button"><i class="bi bi-plus"></i></button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4" />

              <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
                <div class="small text-secondary" id="modalAppliedCount">Belum ada rewards dipilih</div>
                <div class="d-flex gap-2">
                  <button class="btn btn-outline-secondary" id="btnReset" type="button">Reset</button>
                  <button class="btn btn-primary" id="btnApply" type="button" data-bs-dismiss="modal">Terapkan</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS (with Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ===== Demo Data =====
    const sampleMembers = [
      { id: "M-00123", name: "Dina Kartika", level: "Gold", exp: 12850, points: 7420, birthday: "12 Nov", phone: "+62 812 3456 7890" },
      { id: "M-00456", name: "Bima Pratama", level: "Silver", exp: 5100, points: 2140, birthday: "03 Jan", phone: "+62 813 1122 3344" },
      { id: "M-00899", name: "Rina Fauzi", level: "Platinum", exp: 30500, points: 18200, birthday: "22 Aug", phone: "+62 815 7788 9911" },
    ];

    // ===== State (Design only) =====
    let selected = sampleMembers[0];
    let useBirthday = false;
    let levelRewards = new Set(); // 'discount10' | 'upgrade' | 'priority'
    let useExp = false;
    let expQty = 0;

    // ===== Elements =====
    const memberListEl = document.getElementById('memberList');
    const searchInput = document.getElementById('searchInput');

    const summaryBadgesEl = document.getElementById('summaryBadges');
    const summaryMemberNameEl = document.getElementById('summaryMemberName');
    const summaryMemberIdEl = document.getElementById('summaryMemberId');
    const appliedCountTextEl = document.getElementById('appliedCountText');

    // Modal elements
    const modalMemberName = document.getElementById('modalMemberName');
    const modalMemberMeta = document.getElementById('modalMemberMeta');
    const modalLevelBadge = document.getElementById('modalLevelBadge');
    const modalExp = document.getElementById('modalExp');
    const modalPoints = document.getElementById('modalPoints');
    const modalBirthday = document.getElementById('modalBirthday');
    const modalAvatar = document.getElementById('modalAvatar');
    const birthdayValidity = document.getElementById('birthdayValidity');

    const chkBirthday = document.getElementById('chkBirthday');
    const chkLevelDiscount10 = document.getElementById('chkLevelDiscount10');
    const chkLevelUpgrade = document.getElementById('chkLevelUpgrade');
    const chkLevelPriority = document.getElementById('chkLevelPriority');

    const chkExp = document.getElementById('chkExp');
    const btnExpMinus = document.getElementById('btnExpMinus');
    const btnExpPlus = document.getElementById('btnExpPlus');
    const expQtyEl = document.getElementById('expQty');
    const expAvailableEl = document.getElementById('expAvailable');

    const modalAppliedCount = document.getElementById('modalAppliedCount');
    const btnReset = document.getElementById('btnReset');
    const btnApply = document.getElementById('btnApply');

    const openRewardsBtn = document.getElementById('openRewardsBtn');

    // ===== Helpers =====
    const levelClass = (level) => ({
      'Silver': 'level-silver',
      'Gold': 'level-gold',
      'Platinum': 'level-platinum',
    })[level] || 'level-silver';

    function initials(name) {
      const parts = name.trim().split(/\s+/);
      return (parts[0]?.[0] || 'M') + (parts[parts.length - 1]?.[0] || 'B');
    }

    function renderMemberList(list = sampleMembers) {
      const q = searchInput.value.trim().toLowerCase();
      const filtered = list.filter(m =>
        m.name.toLowerCase().includes(q) ||
        m.id.toLowerCase().includes(q) ||
        m.phone.replaceAll(' ', '').includes(q.replaceAll(' ', ''))
      );

      memberListEl.innerHTML = '';
      if (!filtered.length) {
        memberListEl.innerHTML = `<div class="list-empty py-4 text-center">Tidak ada member yang cocok.</div>`;
        return;
      }

      filtered.forEach(m => {
        const isSelected = m.id === selected.id;
        const card = document.createElement('div');
        card.className = `card mb-2 hover-card ${isSelected ? 'border-primary' : ''}`;
        card.innerHTML = `
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center gap-3 pointer select-member">
                <div class="avatar">${initials(m.name)}</div>
                <div>
                  <div class="fw-semibold">${m.name}</div>
                  <div class="small text-secondary">${m.id} • ${m.phone}</div>
                </div>
              </div>
              <span class="badge rounded-pill ${levelClass(m.level)}">${m.level}</span>
            </div>
            <div class="d-flex justify-content-between small text-secondary mt-2">
              <div>EXP <span class="fw-semibold text-body">${m.exp.toLocaleString()}</span></div>
              <div>Points <span class="fw-semibold text-body">${m.points.toLocaleString()}</span></div>
              <div class="d-flex align-items-center gap-1"><i class="bi bi-cake2"></i> ${m.birthday}</div>
            </div>
            <div class="mt-3 text-end">
              <button class="btn btn-sm btn-primary btn-open" data-id="${m.id}" data-bs-toggle="modal" data-bs-target="#rewardsModal">Buka Rewards</button>
            </div>
          </div>`;

        // Select member by clicking the top area
        card.querySelector('.select-member').addEventListener('click', () => {
          selected = m; updateSummary(); renderMemberList(list);
        });
        // Open modal button
        card.querySelector('.btn-open').addEventListener('click', () => openRewardsModal(m.id));

        memberListEl.appendChild(card);
      });
    }

    function updateSummary() {
      summaryMemberNameEl.textContent = selected.name;
      summaryMemberIdEl.textContent = selected.id;
      renderSummaryBadges();
    }

    function renderSummaryBadges() {
      summaryBadgesEl.innerHTML = '';
      const badges = [];
      if (useBirthday) badges.push(`<span class="badge text-bg-secondary badge-pill"><i class="bi bi-cake2 me-1"></i>Birthday Reward</span>`);
      if (levelRewards.has('discount10')) badges.push(`<span class="badge text-bg-secondary badge-pill"><i class="bi bi-percent me-1"></i>Level: Diskon 10%</span>`);
      if (levelRewards.has('upgrade')) badges.push(`<span class="badge text-bg-secondary badge-pill"><i class="bi bi-arrow-up-circle me-1"></i>Level: Upgrade Size</span>`);
      if (levelRewards.has('priority')) badges.push(`<span class="badge text-bg-secondary badge-pill"><i class="bi bi-lightning-charge me-1"></i>Level: Priority</span>`);
      if (useExp && expQty > 0) badges.push(`<span class="badge text-bg-secondary badge-pill"><i class="bi bi-cup-hot me-1"></i>EXP x${expQty} • Kopi Susu</span>`);
      if (!badges.length) summaryBadgesEl.innerHTML = `<span class="small text-secondary">Belum ada rewards dipilih.</span>`;
      else summaryBadgesEl.innerHTML = badges.join(' ');

      const appliedCount = (useBirthday ? 1 : 0) + levelRewards.size + ((useExp && expQty > 0) ? 1 : 0);
      appliedCountTextEl.textContent = appliedCount ? `${appliedCount} rewards dipilih` : 'Belum ada rewards dipilih';
      modalAppliedCount.textContent = appliedCountTextEl.textContent;
    }

    function calcExpSteps() { return Math.floor((selected?.exp || 0) / 5000); }

    function updateExpControls() {
      const max = calcExpSteps();
      expAvailableEl.textContent = max;
      if (!useExp || max === 0) {
        expQty = 0; expQtyEl.textContent = '0';
        btnExpMinus.disabled = true; btnExpPlus.disabled = true;
      } else {
        btnExpMinus.disabled = expQty <= 0;
        btnExpPlus.disabled = expQty >= max;
      }
    }

    function openRewardsModal(memberId) {
      const m = sampleMembers.find(x => x.id === memberId) || selected;
      selected = m; // set current
      // Fill left panel
      modalMemberName.textContent = m.name;
      modalMemberMeta.textContent = `${m.id} • ${m.phone}`;
      modalLevelBadge.className = `badge rounded-pill ${levelClass(m.level)}`;
      modalLevelBadge.textContent = m.level;
      modalExp.textContent = m.exp.toLocaleString();
      modalPoints.textContent = m.points.toLocaleString();
      modalBirthday.textContent = m.birthday;
      modalAvatar.textContent = initials(m.name);

      // Example validity (illustrative)
      const parts = m.birthday.split(' ');
      birthdayValidity.textContent = parts.length === 2 ? `1–30 ${parts[1]}` : 'Bulan ulang tahun';

      // Keep current selections (design-only) — update UI checks
      chkBirthday.checked = useBirthday;
      chkLevelDiscount10.checked = levelRewards.has('discount10');
      chkLevelUpgrade.checked = levelRewards.has('upgrade');
      chkLevelPriority.checked = levelRewards.has('priority');

      chkExp.checked = useExp;
      expQtyEl.textContent = String(expQty);
      updateExpControls();

      updateSummary();
    }

    // ===== Events =====
    searchInput.addEventListener('input', () => renderMemberList());

    openRewardsBtn.addEventListener('click', () => openRewardsModal(selected.id));

    chkBirthday.addEventListener('change', (e) => { useBirthday = e.target.checked; renderSummaryBadges(); });

    chkLevelDiscount10.addEventListener('change', (e) => {
      if (e.target.checked) levelRewards.add('discount10'); else levelRewards.delete('discount10');
      renderSummaryBadges();
    });
    chkLevelUpgrade.addEventListener('change', (e) => {
      if (e.target.checked) levelRewards.add('upgrade'); else levelRewards.delete('upgrade');
      renderSummaryBadges();
    });
    chkLevelPriority.addEventListener('change', (e) => {
      if (e.target.checked) levelRewards.add('priority'); else levelRewards.delete('priority');
      renderSummaryBadges();
    });

    chkExp.addEventListener('change', (e) => {
      useExp = e.target.checked;
      updateExpControls();
      renderSummaryBadges();
    });

    btnExpMinus.addEventListener('click', () => {
      if (!useExp) return; if (expQty <= 0) return; expQty--; expQtyEl.textContent = String(expQty); updateExpControls(); renderSummaryBadges();
    });
    btnExpPlus.addEventListener('click', () => {
      if (!useExp) return; const max = calcExpSteps(); if (expQty >= max) return; expQty++; expQtyEl.textContent = String(expQty); updateExpControls(); renderSummaryBadges();
    });

    btnReset.addEventListener('click', () => {
      useBirthday = false; levelRewards.clear(); useExp = false; expQty = 0;
      chkBirthday.checked = false; chkLevelDiscount10.checked = false; chkLevelUpgrade.checked = false; chkLevelPriority.checked = false; chkExp.checked = false;
      expQtyEl.textContent = '0'; updateExpControls(); renderSummaryBadges();
    });

    btnApply.addEventListener('click', () => {
      // Design-only: simply reflects choices in summary and closes modal via data-bs-dismiss
      renderSummaryBadges();
    });

    // ===== Init =====
    renderMemberList();
    updateSummary();
    renderSummaryBadges();
  </script>
</body>
</html>
